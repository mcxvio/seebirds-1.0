<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hunt's eBirds</title>
    <link rel="stylesheet" type="text/css" href="script.tablesorter/styles.tablesorter.css">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="script.tablesorter/jquery.tablesorter.min.js"></script>
    <script src="script.custom/jquery.custom.mobile.js"></script>
    <script src="script.custom/jquery.formatDateTime.min.js"></script>
    <!-- jQM -->
    <link rel="stylesheet" href="//code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="//code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!-- end jQM -->
    <link rel="stylesheet" type="text/css" href="style.custom/styles.custom.css">
    <script>
        //var urlBase = "http://huntsebirds.appspot.com/";
        var urlBase = "https://mebird-mrhapi.c9users.io/";
        var dataFile = "data/region_usa_ma.xml";
        var noDataFound = "No data found, please search again.";

        (function( $ ) {
            $(function() { // On document ready
                $.spinner();
            });

            var selectedData = { region: "", locId: "", locName: "", sciName: "", comName: "", startPage: "" };
            
            // Load autocomplete values & handle selection.
            $(document).on("pagecreate", "div[data-role=page]", function(event, ui) {
                var page = $(this).attr("id");
                if (page == "checklists" || page == "notables") {
                    $.populateAutocompletes(page, urlBase, dataFile);
                }
                // Set current copyright year.
                $(".copyrightYear").html($.getCurrentYear());
            });

            // Save selected region from autocomplete.
            $(document).on("click", "a.gotoRegion", function() {
                selectedData.region = $(this).text();
            });

            $(document).pagecontainer({ beforeshow: function(event, ui) { } });
            // Load results data.
            $(document).on("pagecontainerbeforeshow", function(event, ui){
                var toPage = ui.toPage[0].id;
                var page = "#" + toPage;
                var message = noDataFound;
                var tableData = "";

                console.log("pagecontainerbeforeshow: " + toPage);

                if (toPage == "submissions") {
                    if (selectedData.region.length > 0) {
                        tableData = $.getTableData("checklistsResults", "checklistsRegion", selectedData.region, "checklists", "", "");

                        if (tableData.table.rows.length > 0) {
                            message = "Checklists with *count of species seen most recently in " + selectedData.region + ", in last 5 days: " + (tableData.table.rows.length-1) + ".";
                        }
                    } else {
                        message = "<a href='#nav-panel-checklist-sightings'>Select</a> from Checklists or Notables to search State or County sightings.";
                    }
                }
                if (toPage == "sightings") {
                    if (selectedData.region.length > 0) {
                        tableData = $.getTableData("notablesResults", "notablesRegion", selectedData.region, "notables", "", "");

                        if (tableData.table.rows.length > 0) {
                            message = "Notable species for " + selectedData.region + ", in last 5 days: " + tableData.data + ".";
                        }
                    } else {
                        message = "<a href='#nav-panel-notable-sightings'>Select</a> from Checklists or Notables to search State or County sightings.";
                    }
                }
                if (toPage == "location") {
                    tableData = $.getTableData("", "", "", "location", selectedData.locId);
                    if (tableData.table.rows.length > 0) {
                        message = 'Sightings at <a href="http://ebird.org/ebird/hotspot/' + selectedData.locId + '" target="_blank">' + selectedData.locName + '</a> in last 14 days: ' + tableData.data + '.';
                    }
                }
                if (toPage == "species") {
                    console.log("selectedData,1: " + JSON.stringify(selectedData));
                    selectedData = $.populateIdentifySpecies(selectedData);
                    console.log("selectedData,2: " + JSON.stringify(selectedData));

                    if (selectedData.sciName != "") {
                        tableData = $.getTableData("", "", selectedData.region, "species", "", selectedData.sciName);
                        if (tableData.table.rows.length > 0) {
                            message = 'Sightings of <a href="identify.html" rel="external" data-ajax="false">' + selectedData.comName + '</a> in ' + selectedData.region + ' in last 14 days: ' + tableData.data + '.';
                        }
                    }
                }
                if (tableData != "" && tableData.table.rows.length > 1) {
                    $(page + " #message").html(message);
                    $(page + " #results").html(tableData.table);
                    //$(page + "Table").tablesorter(); //sorting, table name page plus 'Table'.
                    //$(page + "Table").table(); //show/hide columns, table name page plus 'Table'.
                } else if (message != "") {
                    $(page + " #message").html(message);
                    $(page + " #results").html("");
                }
            });

            // Load location data.
            $(document).on("click", "a.gotoLocation", function() {
                selectedData.locId = $(this).attr('title');
                selectedData.locName = $(this).text();
            });

            // Load species data.
            $(document).on("click", "a.gotoSpecies", function() {
                var title = $(this).attr('title');
                var sciName = $.getSubRegionFromSelection(title);
                var comName = title.substring(0, title.indexOf('(')-1);
                selectedData.sciName = sciName;
                selectedData.comName = comName;
            });
        })( jQuery );
    </script>
</head>
<body>
    <!-- Home -->
    <div data-role="page" id="home" data-title="home">
        <div data-role="header" data-id="site-header" data-position="inline">
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="iu-content">
            <ul data-role="listview"><li><a id="gotoChecklists" href="#checklists">checklists</a></li>
            <li><a id="gotoNotables" href="#notables">notables</a></li></ul>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Checklists Search -->
    <div data-role="page" id="checklists" data-title="hunt's ebirds | checklists">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-checklists" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="ui-content">
            <!-- Autocomplete -->
            <form class="ui-filterable"><input id="autocomplete-input-checklists" data-type="search" placeholder="Search for State or County" autofocus="autofocus"></form>
            <ul id="autocomplete-items-checklists" data-role="listview" data-inset="true" data-filter="true" data-input="#autocomplete-input-checklists"></ul>
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-checklists" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#checklists" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists" class="ui-btn ui-btn-active">checklists</a></li>
                <li><a href="#notables" id="gotoNotables">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a></p>
        </div>
    </div>
    <!-- Checklists Submissions Results -->
    <div data-role="page" id="submissions" data-title="hunt's ebirds | sightings">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-checklist-sightings" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="ui-content">
            <div id="message"></div>
            <div id="results"></div>
            <br />
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-checklist-sightings" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#submissions" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists">checklists</a></li>
                <li><a href="#notables" id="gotoNotables">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Notables Search -->
    <div data-role="page" id="notables" data-title="hunt's ebirds | notables">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-notables" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div data-role="main" class="ui-content">
            <!-- Autocomplete -->
            <form class="ui-filterable"><input id="autocomplete-input-notables" data-type="search" placeholder="Search for State or County" autofocus="autofocus"></form>
            <ul id="autocomplete-items-notables" data-role="listview" data-inset="true" data-filter="true" data-input="#autocomplete-input-notables"></ul>
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-notables" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#notables" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists">checklists</a></li>
                <li><a href="#notables" id="gotoNotables" class="ui-btn ui-btn-active">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Notable Sightings Results -->
    <div data-role="page" id="sightings" data-title="hunt's ebirds | sightings">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-notable-sightings" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="ui-content">
            <div id="message"></div>
            <div id="results"></div>
            <br />
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-notable-sightings" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#sightings" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists">checklists</a></li>
                <li><a href="#notables" id="gotoNotables">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Location Results -->
    <div data-role="page" id="location" data-title="hunt's ebirds | location">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-location" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="ui-content">
            <div id="message"></div>
            <div id="results"></div>
            <br />
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-location" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#location" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists">checklists</a></li>
                <li><a href="#notables" id="gotoNotables">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Species Results -->
    <div data-role="page" id="species" data-title="hunt's ebirds | species">
        <div data-role="header" data-id="site-header">
            <a href="#nav-panel-species" data-icon="bars" data-iconpos="notext">Menu</a>
            <h1><a href="index.html">home</a></h1>
        </div>
        <div role="main" class="ui-content">
            <div id="message"></div>
            <div id="results"></div>
            <br />
            <!-- Nav Panel -->
            <div data-role="panel" id="nav-panel-species" data-display="overlay" data-position="left">
                <ul data-role="listview">
                <li><a href="#species" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">close</a>
                <li><a href="#checklists" id="gotoChecklists">checklists</a></li>
                <li><a href="#notables" id="gotoNotables">notables</a></li>
                </ul>
            </div>
        </div>
        <div data-role="footer" class="centerbox">
            <p class="copyright">&copy <span class="copyrightYear"></span> M Hunt. Data by <a href="http://www.ebird.org" target="_blank">eBird</a>
        </div>
    </div>
    <!-- Donate -> todo separate page -->
    <!-- Providers -> todo separate page -->
</body>
</html>
